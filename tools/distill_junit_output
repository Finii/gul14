#!/bin/sh
#
# Distill a clean JUnit XML file from the JSON file generated by mesontest.
# This requires that the unit tests are run with the parameter "-r junit".

if [ $# -ne 2 ]; then
    echo "Usage: `basename "$0"` in_json out_xml"
    echo "       Distill a mesontest-generated JSON file into a clean JUnit XML file."
    echo ""
    exit 1
fi

echo '<?xml version="1.0" encoding="UTF-8"?>' >"$2"
echo '<testsuites>' >>"$2"
cat "$1" | sed -r -e 's/^.*?<testsuites>(.*)<\/testsuites>.*?$/\1/' -e 's/\\(n|([\\"]))/\2/g' >>"$2"
echo '</testsuites>' >>"$2"

echo "Created $2"
